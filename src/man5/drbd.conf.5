." © 2005-2007 DLOU, GNU FDL
." URL: <http://docs.linux.org.ua/index.php/Man_Contents>
." Supported by <docs@linux.org.ua>
."
." Permission is granted to copy, distribute and/or modify this document
." under the terms of the GNU Free Documentation License, Version 1.2
." or any later version published by the Free Software Foundation;
." with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
." 
." A copy of the license is included  as a file called COPYING in the
." main directory of the man-pages-* source package.
."
." This manpage has been automatically generated by wiki2man.py
." This tool can be found at: <http://wiki2man.sourceforge.net>
." Please send any bug reports, improvements, comments, patches, etc. to
." E-mail: <wiki2man-develop@lists.sourceforge.net>.

.TH "drbd.conf" "5" "v 0.7.* переклад: бета версія 2007-10-27-16:31" "© 2005-2007 DLOU, GNU FDL" "DRBD - кластер дисків"

." This manpage has been automatically generated by docbook2man from a DocBook document.
." This tool can be found at: <http://shell.ipoline.com/~elmert/comp/docbook2X/>
." Please send any bug reports, improvements, comments, patches, etc.
." to Steve Cheng <steve@ggi-project.org>. 

.SH "ІМ'Я"
.PP

drbd.conf \- Конфігураційний файл для пристроїв DRBD.

.SH "ВСТУП"
.PP

Файл \fB/etc/drbd.conf\fR використовується програмами \fB/etc/init.d/drbd\fR та \fB/etc/ha.d/resource.d/drbddisk\fR котрі є частиною пакету DRBD.
.br

.br

Формат файлу розроблений так, що дозволяє нам мати ідентичні копії файлу на обох вузлах кластеру. Настирливо рекомендується цим скористатись для забезпечення нормального управління конфігурацією. Файл  \fB/etc/drbd.conf\fR повинен бути однаковий на обох вузлах кластеру. Зміни в \fB/etc/drbd.conf\fR не вступають в силу негайно.
.br

.br

Маленький приклад файлу \fB/etc/drbd.conf\fR

.RS
.nf
   resource drbd0 {
       protocol C;
       incon\-degr\-cmd "halt \-f";
   
      on primarydhcp {
           device    /dev/drbd1;
           disk      /dev/hda7;
           address   10.0.0.10:7789;
           meta\-disk  internal;
       }
 
       on secondarydhcp {
           device    /dev/drbd1;
           disk      /dev/hda7;
           address   10.0.0.11:7789;
           meta\-disk  internal;
       }
    }

.fi
.RE
В цьому прикладі є тільки один ресурс DRBD (названий drbd0) котрий використовує протокол C для зв'язку між його пристроями. Пристрій, що працює на вузлі \fB\fIprimarydhcp\fB\fR  використовує  \fB\fI/dev/drbd1\fB\fR  як блочний пристрій для своїх програм, і \fB\fI/dev/hda7\fB\fR як низькорівневий масив збереження даних. IP адрес використовується для вказання мережевого з'єднання.
.br

.br

Можна визначати багато розділів з ресурсами в одному файлі drbd.conf.

.SH "СТРУКТУРА ФАЙЛУ"
.PP

Файл складається з розділів і параметрів. Розділ починається з ключового слова, часом з додаткового імені та відкриває дужки (``{``).  Розділ закінчується закриванням дужки (``}``). Між дужками містяться параметри.

.RS
.nf
 section [name] { parameter value; [...] }

.fi
.RE
Параметри починаються з імені параметру відділеного від значення пробілом. Кожний символ, що слідує за пробілом вважається частиною значення параметру. Виключенням є логічний (Boolean) параметр котрий містить тільки ідентифікатор. Параметр закінчується символом крапка з комою (``;``).
.br

.br

Деякі значення параметру мають визначені символи: K, M or G. котрі визначаються у звичний спосіб (K = 2^10 = 1024, M =  1024 K, G = 1024 M).
.br

.br

Файл може містити коментарі, які мусять починатись з (``#``). Після символу (``#``) дані ігноруються до кінця стрічки.

.SH "РОЗДІЛИ"
.PP

.TP
.B skip 
Коментує текстове сміття, якщо воно навіть займає більш ніж одну стрічку. Символи між ключовим словом skip та відкритою дужкою (``{``) ігноруються. Все поміщене між дужки пропускається. Це допомагає коментувати цілі розділи:

.RS
.nf
  skip {
             resource [name] {...} 
          }

.fi
.RE
просто помістивши їх між дужки skip.

.TP
.B global 
Вказує деякі глобальні параметри. Поки що дозволеними є \fBminor\-count\fR, \fBdialog\-refresh\fR та \fBdisable\-io\-hints\fR. Можна використовувати тільки один розділ global, бажано самий перший.

.TP
.B resource \fB\fIname\fB\fR
Визначає сам ресурс DRBD. Кожний розділ, визначаючий ресурс, мусить містити дві секції "on ім'я\-вузла" і може мати також секції \fBstartup\fR, \fBsyncer\fR, \fBnet\fR та \fBdisk\fR. Обов'язковим параметром розділу є protocol. Не обов'язковим: \fBincon\-degr\-cmd\fR.

.TP
.B on \fB\fIhost\-name\fB\fR
Поєднує необхідні параметри конфіґурації DRBD пристрою для включених ресурсів. \fB\fIhost\-name\fB\fR є обов'язковим і мусить відповідати імені Лінукс компа (uname \-n) одного з вузлів. Обов'язковими параметрами секції є: \fBdevice\fR, \fBdisk\fR, \fBaddress\fR, \fBmeta\-disk\fR.

.TP
.B disk
Цей розділ використовується для оптимізації DRBD пристроїв, а саме властивостей пов'язаних з низькорівневим обладнанням. Для детальної інформації про параметри читайте \fBdrbdsetup(8)\fR. Необов'язковим параметром є: \fBon\-io\-error\fR.

.TP
.B net
Розділ використовують для оптимізації мережевих властивостей DRBD. Для детальної інформації про параметри читайте \fBdrbdsetup(8)\fR. Необов'язковими параметрами є: \fBsndbuf\-size\fR, \fBtimeout\fR, \fBconnect\-int\fR, \fBping\-int\fR, \fBmax\-buffers\fR, \fBmax\-epoch\-size\fR, \fBko\-count\fR, \fBon\-disconnect\fR.

.TP
.B startup
Розділ використовують для оптимізації властивостей запуску DRBD. Для детальної інформації про параметри читайте \fBdrbdsetup(8)\fR. Необов'язковими параметрами є: \fBwfc\-timeout\fR, \fBdegr\-wfc\-timeout\fR.

.TP
.B syncer
Розділ використовують для оптимізації пристрою синхронізаційного сервісу. Для детальної інформації про параметри читайте \fBdrbdsetup(8)\fR. Необов'язковими параметрами є: \fBrate, group\fR, \fBal\-extents\fR.

.SH "ПАРАМЕТРИ"
.PP

.TP
.B minor\-count \fB\fIcount\fB\fR 
\fB\fIcount\fB\fR може бути числом від 1 до 255.
.br

.br
Використовуйте \fB\fIminor\-count\fB\fR, якщо бажаєте визначити більше ресурсів потім без перевантаження DRBD модуля ядра. По замовчуванню модуль вантажиться стільки раз скільки пристроїв визначено в конфігураційному файлі. По замовчуванню модуль збирається з 2, а монолітне ядро з 8. Для монолітного ядра параметр \fB\fIminor\-count\fB\fR ігнорується, для зміни потрібно вказати параметр завантаження ядра \fB\fIdrbd.minor_count=count\fB\fR.

.TP
.B dialog\-refresh \fB\fItime\fB\fR 
\fB\fIчас\fB\fR може бути >=0
.br

.br
Час в секундах і кількість разів скільки виводиться користувацьке застереження (не виводиться коли 0). По замовчуванню 1.

.TP
.B disable\-io\-hints 
Використовуйте \fB\fIdisable\-io\-hints\fB\fR якщо бажаєте встановити DRBD пристрій через зворотню петлю, чи між двома віртуальними серверами на одній машині, для тестування чи презентації. Не потрібна з ядром 2.6.*

.TP
.B protocol \fB\fIprot\-id\fB\fR 
По верх TCP/IP використовується спеціальний \fB\fIпротокол\fB\fR. Допустимі протоколи: A, В, та C.
.br

.br
\fB\fIПротокол А\fB\fR: операція запису вважається завершеною, якщо дані досягли локального диску та локальної вихідної черги tcp.
.br

.br
\fB\fIПротокол В\fB\fR: операція запису вважається завершеною, якщо дані досягли локального диску та віддаленого буферу.
.br

.br
\fB\fIПротокол С\fB\fR: операція запису вважається завершеною, якщо дані досягли обох, локального та віддаленого, дисків.

.TP
.B incon\-degr\-cmd \fB\fIcommand\fB\fR
У випадку коли при включенні вузла він вантажиться у виродженому режимі  (inittimeout включений) і якщо локальна реплікація даних не є повна, запускається \fB\fIcommand\fB\fR. Якщо команда виконується без помилок drbddisk вважає що DRBD пристрій є в основному стані (primary).

.TP
.B device \fB\fIname\fB\fR 
Ім'я блочного пристрою вузла, що описується в розділі resource. Ви мусите використовувати саме цей пристрій для роботи з програмами (файловими системами) і ніколи не використовуйте низькорівневий блочний пристрій котрий вказаний з параметром disk.
.br

.br
Пристрій вузла мусить мати той самий головний номер, як і пристрій DRBD. В поточній реалізації використовується головний номер 147 і відповідні пристрої вузла називають \fB/dev/drbd0\fR, \fB/dev/drbd1\fR,...
.br

.br
При встановлені DRBD пакету скрипт створює \fB/dev/drbd0 ... /dev/drbd8\fR. Для переконання пошукайте за /dev/drbd*.

.TP
.B disk \fB\fIname\fB\fR 
DRBD використовує цей пристрій для запису та зчитування даних. НІКОЛИ не користуйтесь цим пристроєм коли поверх нього працює DRBD. Це також відноситься до dumpe2fs(8) та подібних команд.

.TP
.B address \fB\fIIP
port\fB\fR :ресурс потребує вказати по парі \fB\fIIP:port\fB\fR адрес на кожний пристрій, котрий використовується для очікування вхідного зв'язку від пристрою іншого вузла,  для встановлення з ним зв'язку.
.br

.br
Кожний DRBD ресурс потребує \fB\fITCP\fB\fR порт котрий використовують для зв'язку з пристроєм партнерського вузла. Два різні DRBD ресурси не можуть використовувати ту саму пару \fB\fIIP:port\fB\fR на одному вузлі.

.TP
.B meta\-disk \fB\fIinternal\fB\fR 

.TP
.B meta\-disk \fB\fIdevice\fB\fR \fB\fI[index]\fB\fR 
internal означає що останні 128 MB низькорівневого пристрою використовуються для службових даних. Не можна використовувати \fB\fI[index]\fB\fR разом з internal.
.br

.br
Можна використовувати єдиний блочний \fB\fIпристрій\fB\fR для зберігання службових даних багатьох DRBD пристроїв. Тобто використовуйте meta\-disk /dev/hde6[0]; та meta\-disk /dev/hde6[1]; для двох різних ресурсів. В цьому випадку мінімальний розмір для meta\-disk мусить бути 256 MB.

.TP
.B on\-io\-error \fB\fIhandler\fB\fR 
\fB\fIhandler\fB\fR включається, коли низькорівневий пристрій посилає помилку зчитування/запису на верхній рівень.
.br

.br
\fB\fIhandler\fB\fR може бути : pass_on, panic, чи detach.
.br

.br
pass_on: Повідомляє помилку зчитування/запису на верхній рівень. На основному вузлі повідомляє примонтовану файлову систему. На другорядному ігнорує.
.br

.br
panic: Вузол залишає кластер створюючи паніку ядра.
.br

.br
detach: Вузол ігнорує низькорівневий пристрій та продовжує роботу в бездисковому режимі.

.TP
.B sndbuf\-size \fB\fIsize\fB\fR 
\fB\fIsize\fB\fR є розміром вихідної черги TCP. По замовчуванню 128K. Можна вказати більше чи менше значення. Більше значення краще для збільшення пропускної здатності при використанні протоколу А через  дуже стабільну мережу. Дуже великі значення ~1M можуть привести до проблем. А значення менші 32K не доречні.

.TP
.B timeout \fB\fItime\fB\fR 
Якщо партнерський вузол не може відіслати пакет з відповіддю протягом \fB\fItime\fB\fR десятих секунди, партнерський вузол вважається не робочим і тому TCP/IP зв'язок до нього розривається. Це значення мусить бути меншим ніж \fB\fIconnect\-int\fB\fR та \fB\fIping\-int\fB\fR. По замовчуванню є 60 = 6 секунд, крок 0.1 секунди.

.TP
.B connect\-int \fB\fItime\fB\fR 
У випадку неможливості зв'язку з віддаленим DRBD пристроєм негайно, DRBD продовжує спроби зв'язатись. З допомогою цього параметру можна вказати час між двома спробами. По замовчуванню значення є 10 секунд, крок 1 секунда.

.TP
.B ping\-int \fB\fItime\fB\fR 
Якщо зв'язок TCP/IP між парою пристроїв DRBD є вільним більш ніж time секунд, DRBD буде генерувати пакети keep\-alive, для перевірки справної роботи партнера. По замовчуванню є 10 секунд, крок 1 секунда.

.TP
.B max\-buffers \fB\fInumber\fB\fR 
Максимальне число запитів, що приймається DRBD. Крок є PAGE_SIZE, котрий становіть 4  KB в більшості систем. Нижня грань 32 (=128 KB).  Для забезпечення високої продуктивності допомагає збільшення number. Ця черга використовується для утримування даних поки вони записуються на диск.

.TP
.B max\-epoch\-size \fB\fInumber\fB\fR 
Найвище число блоків даних між двома бар'єрами запису. Якщо встановити меншим за 10 може значно зменшити продуктивність.

.TP
.B ko\-count \fB\fIcount\fB\fR 
У випадку зупинки другорядного вузла під час спроби завершити один запит запису count разів з часовими інтервалами \fB\fItimeout\fB\fR, вузол виключається з кластеру. (Тобто основний вузол переходить у вироджений режим.) По замовчуванню 0, що виключає цю властивість.

.TP
.B on\-disconnect \fB\fIhandler\fB\fR 
Коли зв'язок з партнером пропав, DRBD може або перейти у вироджений режим, або намагатись відновити з'єднання з партнером, або заморозити всі майбутні операції вводу/виводу (подумайте про жорстко примонтований том NFS). Можливими значення є: \fBstand_alone\fR,  \fBreconnect\fR  і  \fBfreeze_io\fR. По замовчуванню \fBreconnect\fR.
.br

.br
\fBstand_alone\fR: Не відновлювати зв'язок і перейти у вироджений режим.
.br

.br
\fBreconnect\fR: Старатись відновити зв'язок.
.br

.br
\fBfreeze_io\fR: Намагатись відновити зв'язок, але заморозити ввід/вивід поки зв'язок не відновиться знов.

.TP
.B wfc\-timeout \fB\fItime\fB\fR 
Чекати на з'єднання протягом часу time. init скрипт \fBdrbd(8)\fR блокує завантажувальний процес поки DRBD ресурси не зв'яжуться. Це буває коли управління кластером стартує пізніше, внутрішні пов'язані з цим ресурси залишаються невидимі. У випадку бажання обмежити час очікування зробіть це тут. По замовчуванню 0, що значить необмежено. Крок 1 секунда.

.TP
.B degr\-wfc\-timeout \fB\fItime\fB\fR 
Очікування для відновленням з'єднання протягом time, якщо вузол був виродженим кластером. У випадку перевантаження виродженого кластера (= кластер в котрого залишивсь тільки один вузол), цей час очікування використовується замість wfc\-timeout, тому що партнер навряд чи включиться в цей проміжок, коли вийшов з ладу перед тим. По замовчуванню 60, крок 1 секунда. Значення 0 означає без обмежень.

.TP
.B rate \fB\fIrate\fB\fR 
Для гарантування стабільної роботи програм поверху DRBD, є можливим обмежити розмір каналу що використовується для синхронізації блочних пристроїв між вузлами кластеру. По замовчуванню 250KB/sec, по замовчуванню крок KB/sec. Можливі суфікси: K, M, G.

.TP
.B group \fB\fInumber\fB\fR 
Десинхронізація пристроїв однієї групи виконується паралельно. Групи отримують доступ послідовно. Потрібно не дозволяти пристроям які поділяють один фізичний пристрій синхронізуватись паралельно. По замовчуванню всі пристрої є в групі 0 тобто будуть синхронізуватись паралельно. Дозволяються від'ємні та позитивні значення.

.TP
.B al\-extents \fB\fIextents\fB\fR 
DRBD автоматично визначає робочої області. Цим параметром контролюється скільки місця виділяється для роботи (=active set). Кожна одиниця відповідає 4M робочого диску (=низькорівневого пристрою). У випадку неочікуваної зупинки основного вузла, розмір даних визначений опцією, мусить бути розсинхронізований до приєднання вузла. Структура даних зберігається в області службових даних, тому кожна зміна робочої області приводить до операції запису на пристрій з службовими даними. Велике число extents дає довший період десинхронізації але менші поновлення до службових даних. По замовчуванню extents є 127. (Мінімум 7, максимум 3843.)

.SH "ВЕРСІЯ"
.PP

Цей документ коректний для версії 0.7.5 пакету DRBD.

.SH "АВТОРИ"
.PP

Написаний Филипом Рейзнером (Philipp  Reisner)  <philipp.reisner@linbit.com>.

Сторінка підручника була переглянута та переписана Гелмутом Воллмерсдорфером (Helmut Wollmersdorfer) <helmut.wollmersdorfer@linbit.com>.

.SH "ПОВІДОМЛЕННЯ ПОМИЛОК"
.PP

Повідомляйте помилки на <drbd\-user@lists.linbit.com>.

.SH "АВТОРСЬКІ ПРАВА"
.PP

Copyright (c) 2001 Philipp Reisner. Це вільні програми; дивіться джерельні коди для встановлення прав копіювання. Нема ніяких гарантій; навіть для зручності використання в конкретному випадку.

.SH "ПОДІБНІ ТЕМИ"
.PP

\fBdrbd \- кластер дисків\fR, \fBdrbd(8)\fR, \fBdrbddisk(8)\fR, \fBdrbdsetup(8)\fR, \fBdrbdadm(8)\fR.

