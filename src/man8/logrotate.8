." © 2005-2007 DLOU, GNU FDL
." URL: <http://docs.linux.org.ua/index.php/Man_Contents>
." Supported by <docs@linux.org.ua>
."
." Permission is granted to copy, distribute and/or modify this document
." under the terms of the GNU Free Documentation License, Version 1.2
." or any later version published by the Free Software Foundation;
." with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
." 
." A copy of the license is included  as a file called COPYING in the
." main directory of the man-pages-* source package.
."
." This manpage has been automatically generated by wiki2man.py
." This tool can be found at: <http://wiki2man.sourceforge.net>
." Please send any bug reports, improvements, comments, patches, etc. to
." E-mail: <wiki2man-develop@lists.sourceforge.net>.

.TH "logrotate" "8" "v 3.6.5 переклад: бета версія 2007-10-27-16:31" "© 2005-2007 DLOU, GNU FDL" "Ротація журналів"

.SH "ІМ'Я"
.PP

logrotate \- циклічно переміщує, архівує та посилає електронною почтою системні журнали.

.SH "ВИКОРИСТАННЯ"
.PP

.RS
.nf
 logrotate [\-dv] [\-f|\-\-force] [\-s|\-\-state file] config_file+

.fi
.RE

.SH "ОПИС"
.PP

\fBlogrotate\fR розроблений для полегшення адміністрування систем, що ведуть велику кількість журналів. Він також забезпечує ротацію, архівацію, видалення та відправку журналів електронною почтою. Кожний журнал може переміщатись щоденно, потижнево чи щомісячно, або при досягненні ним певного розміру.
.br

.br

Звично \fBlogrotate\fR запускають щоденно з допомогою cron.  Це не значить що він буде модифікувати журнали кілька раз в день хіба, що критерій розміру журналу на якому засновується циклічна заміна журналів буде виконуватись і \fBlogrotate\fR запускатиметься кілька разів на день, або з опцією \fB\-f\fR, або \fB\-force\fR для примусової циклічної заміни журналів.
.br

.br

Будь\-яке число файлів з налаштуваннями можна вказати в командній стрічці. Файли вказані пізніше змінюють опції вказані у попередніх файлах, так, що порядок конфіґураційних файлів у \fBlogrotate\fR є важливий. Зазвичай використовується єдиний конфіґураційний файл, котрий включає будь\-які інші необхідні файли з налаштуваннями. Нижче описано, як це робиться з допомогою  директиви \fB\fIinclude\fB\fR. Якщо в командній стрічці вказано директорію то кожний файл з цієї директорії використовується, як файл налаштувань.
.br

.br

Якщо не вказано ніяких параметрів у командній стрічці \fBlogrotate\fR видрукує версію і авторські права та коротеньку інформацію по використанню і закінчить роботу. При появі будь\-яких помилок під час виконання \fBlogrotate\fR припинить роботу з не нульовим статусом.

.SH "ОПЦІЇ"
.PP

.TP
.B \-d
Вмикає відлагоджувальний режим і додає \fB\-v\fR. У відлагоджувальному режимі ніяких змін з файлами журналів чи файлу стану \fBlogrotate\fR.

.TP
.B \-f, \-\-force
Вказує  \fBlogrotate\fR насильно проводити циклічну заміну журналів, навіть, коли нема в цьому необхідності. Деколи це корисно після додавання нового пункту в \fBlogrotate\fR, чи для створення нових файлів журналів, коли старі файли журналів були переміщені вручну, щоб протоколювання могло продовжуватись далі коректно.

.TP
.B \-m, \-\-mail <command>
Вказує \fBlogrotate\fR яку команду використовувати для пересилки журналів електронною почтою. Ця команда повинна приймати два параметри 1) тему повідомлення, і 2) адрес отримувача. Далі команда повинна зчитати повідомлення з стандартного вводу і відіслати адресату. По замовленню використовується \fB/bin/mail \-s\fR.

.TP
.B \-s, \-\-state <statefile>
Вказує \fBlogrotate\fR використовувати альтернативний файл статусу. Це корисно коли ротація стартує під різними користувачами для різних файлів стану. По замовчуванню використовується \fB\fI/var/lib/logrotate.status\fB\fR.

.TP
.B \-\-usage
Виводить коротке повідомлення що до використання.

.SH "ФАЙЛ НАЛАШТУВАНЬ"
.PP

\fBlogrotate\fR зчитує всі вказівки що до дій з журналами з серії файлів налаштування вказаних в командній стрічці. Кожний файл може визначати глобальні опції ( місцеві визначення змінюють глобальні і визначення вказані пізніше змінюють ті що були перед ними) і файли журналів для циклічного переміщення.  Простий файл з налаштуваннями виглядає так:

.RS
.nf
 $ cat /etc/logrotate.conf
 # sample logrotate configuration file
 compress
 
 /var/log/messages {
 rotate 5
 weekly
 postrotate
     /etc/init.d/syslog\-ng reload
 endscript
 }
 
 "/var/log/httpd/access.log" /var/log/httpd/error.log {
 rotate 5
 mail www@my.org
 size=100k
 sharedscripts
 postrotate
      /sbin/killall \-HUP httpd
 endscript
 }
 
 # packages can drop log rotation information into this directory
 include /etc/logrotate.d

 $ cat /etc/logrotate.d/news
 /var/log/news/* {
 monthly
 rotate 2
 olddir /var/log/news/old
 missingok
 postrotate
       kill \-HUP `cat /var/run/inn.pid`
 endscript
 nocompress
 }

.fi
.RE
Перші декілька стрічок визначають глобальні опції, наприклад архівацію журналів після їх циклічної перестановки. Коментарі можна вставляти будь\-де у файлі налаштувань, але перша стрічка коментаря повинна починатись з символу #.

Наступна секція конфігураційного файлу визначає які дії потрібно зробити з журналом \fB\fI/var/log/messages\fB\fR. Журнали будуть циклічно переміщуватись п'ять тижнів перед тим як витруться. Після циклічного переміщення (але перед тим як стара версія журналу почне архівуватися), виконається команда  /etc/init.d/syslog\-ng reload (\fB\fI/sbin/killall\fB\fR \fB\fI\-HUP\fB\fR \fB\fIsyslogd\fB\fR).

Слідуюча секція визначає параметри для двох журналів \fB\fI/var/log/httpd/access.log\fB\fR та \fB\fI/var/log/httpd/error.log\fB\fR.  Вони циклічно переміщуються як тільки розмір журналу стає більшим 100k і старий журнал, після 5 циклічних зсувів, не архівований, перед своїм видаленням, пересилається на адресу www@my.org. \fBsharedscripts\fR означає що скрипт після зсуву \fBpostrotate\fR буде запущений тільки один раз, а не по разу для кожного журналу що проходить ротацію. Увага, лапки навколо першого імені файлу дозволяють \fBlogrotate\fR працювати з іменами файлів журналів, що містять пробіли. Звично командна оболонка використовує лапки ', ", і символ \e .

Директива include /etc/logrotate.d приводить до зчитування всіх файлів, як конфіґураційних, з директорії /etc/logrotate.d

Файл /etc/logrotate.d/news визначає параметри для всіх файлів в \fB\fI/var/log/news\fB\fR. Кожний файл циклічно зсувається з місячним періодом. Це вважається як єдина директива для ротації і якщо помилки будуть більш ніж для одного файлу, то журнали не архівуватимуться.

Будь\-ласка використовуйте * з обережністю. якщо вкажете * \fBlogrotate\fR буде циклічно зсувати кожний файл включаючи попередньо вже зсунуті та заархівовані. Шлях обійти це полягає у використанні директиви \fBolddir\fR чи більш точною вказівкою *.log

Далі наведемо більше інформації про директиви що можуть використовуватись в файлах налаштувань \fBlogrotate\fR:

.TP
.B compress
Стара версія журналу архівується по\-замовчуванню програмою \fBgzip\fR. Також дивіться \fBnocompress\fR.

.TP
.B compresscmd
Вказує котру команду використовувати для архівації журналів. По замовчуванню \fBgzip\fR. Також дивіться директиву \fBcompress\fR.

.TP
.B uncompresscmd
Вказує яку команду використовувати для роз\-архівації журналів. По замовчуванню \fBgunzip\fR.

.TP
.B compressext
Вказує закінчення яке додається до архівованого журналу, якщо архівація включена. По\-замовчуванню використовується закінчення (розширення) архіватора.

.TP
.B compressoptions
Командна стрічка що передається архіватору, якщо він використовується. По\-замовчуванню для \fBgzip\fR, є "\-9" (максимальне стискання).

.TP
.B copy
Робить копію журналу, але не змінює зовсім вхідний. Цю опцію використовують наприклад для отримання копії поточних журналів, чи коли якась стороння утиліта потребує урізати чи обрізувати журнал. Коли використовується \fBcopy\fR то опція \fBcreate\fR не дає ніякого ефекту, так, як старий файл залишається на місці.

.TP
.B copytruncate
Врізає оригінальний файл журналу на місці після створення копії, замість переміщення старого файлу журналу і можливого створення нового. Її використовують коли деякій програмі неможливо сказати закрити попередній журнал і отже вона мусить продовжувати писати (додавати) до попереднього журналу. Увага між копіюванням файлу журналу та урізанням його існує маленький проміжок часу, так що деякі дані можуть пропасти. Коли використовується ця опція то \fBcreate\fR не дає ніякого ефекту, так, як старий файл залишається на місці.

.TP
.B create mode owner group
Негайно після ротації (перед запуском післяротаційного скрипта \fBpostrotate\fR) створюється новий журнал (з тим самим іменем, як і у файлу журналу, що тільки зсунувся). \fBmode\fR вказує права допуску в вісімковій системі (так як у chmod(2), \fBowner\fR вказує власника журналу, а \fBgroup\fR вказує групу до якої належить журнал. Будь\-які файлові атрибути можна пропустити у цьому випадку в новому файлі будуть ті ж атрибути як і в старого журналу, для пропущених атрибутів. Цю опцію відміняє \fBnocreate\fR.

.TP
.B daily
Журнали циклічно переміщуються щодня.

.TP
.B delaycompress
Відтерміновує компресію попереднього журналу до наступного циклу ротації. Ця опція має ефект тільки в комбінації з \fBcompress\fR. Вона може використовуватись коли деякій програмі не можливо вказати закрити свій журнал і тому вона мусить продовжувати писати ще деякий час в попередній журнал.

.TP
.B extension ext
Суфікс журналу що додається до старих журналів після ротації. Якщо використовується архівування, то закінчення архіву (звично .gz) додається останнім. 

.TP
.B ifempty
Вказує циклічно переміщувати пусті журнали, змінює цю поведінку опція \fBnotifempty\fR (по\-замовчуванню використовується \fBifempty\fR).

.TP
.B include file_or_directory
Зчитує файл як параметр там де появляється директива include, так ніби він був включений в командну стрічку. Якщо вказана директорія, більшість файлів з директорії зчитуються в алфавітному порядку перед тим як продовжиться виконання інструкцій з файлу в котрому міститься \fBinclude\fR. Ігноруються тільки не регулярні файли (тобто директорії та посилання) і файли чиї імена закінчуються на одне з заборонених закінчень, які вказані директивою \fBtabooext\fR. Директива \fBinclude\fR не повинна появлятись в середині самого визначення журналу.

.TP
.B mail address
Коли циклічне зсування доходить до кінця, то останній журнал перед видаленням відправляється на вказану адресу. Коли не потрібно робити відправку журналу то вказується директива \fBnomail\fR.

.TP
.B mailfirst
Коли використовується команда \fBmail\fR, то відсилається щойно циклічно переміщений файл замість останнього, що видаляється.

.TP
.B maillast
Коли використовується команда \fBmail\fR, то відсилається останній файл, що видаляється замість того, що щойно циклічно зсунувся (це поведінка по замовчуванню).

.TP
.B missingok
Якщо файлу журналу не існує то програма, замість видачі помилки, переходить до наступного. Також дивіться \fBnomissingok\fR.

.TP
.B monthly
Журнали циклічно зсуваються коли \fBlogrotate\fR запускається перший раз в місяці (звично це першого числа місяця).

.TP
.B nocompress
Старі журнали не архівуються \fBgzip\fR. Також дивіться \fBcompress\fR.

.TP
.B nocopy
Не копіювати оригінальний файл журналу і залишити його на місці (змінює опцію \fBcopy\fR).

.TP
.B nocopytruncate
Не урізувати оригінальний файл журналу після створення його копії (це змінює опцію \fBcopytruncate\fR).

.TP
.B nocreate
Не створюється новий файл після ротації (змінюється опцією \fBcreate\fR).

.TP
.B nodelaycompress
Не відтерміновувати архівацію попередньо зсунутого файлу до наступного циклу (поведінка змінюється опцією \fBdelaycompress\fR).

.TP
.B nomail
Не відсилати нікому старий журнал.

.TP
.B nomissingok
Якщо файл журналів не існує, видає помилку. Ця поведінка є по замовчуванню.

.TP
.B noolddir
Старі журнали циклічно зсуваються в одній і тій ж директорії, що і сам журнал (це змінюється опцією \fBolddir\fR).

.TP
.B nosharedscripts
Запускає перед ротаційний \fBprerotate\fR та після ротаційні \fBpostrotate\fR скрипти для кожного журналу котрий циклічно зсувається (це поведінка по\-замовчуванню, яка змінюється опцією \fBsharedscripts\fR).

.TP
.B notifempty
Не зсувати циклічно пусті журнали (це змінює опцію \fBifempty\fR).

.TP
.B olddir directory
Старі журнали переміщаються в директорію для ротації. Директорія мусить бути на тому самому фізичному пристрої що й журнали. Коли використовується ця опція всі старі версії журналів знаходяться в цій директорії. Опцію можна змінити \fBnoolddir\fR.

.TP
.B postrotate/endscript
Стрічки між \fBpostrotate\fR і \fBendscript\fR (обидві з мусять бути в окремій стрічці) виконуються після ротації журналів. Ця директива може тільки появлятись в середені визначення журналу. також дивіться \fBprerotate\fR.

.TP
.B prerotate/endscript
Стрічки між \fBprerotate\fR і \fBendscript\fR (обидві з мусять бути в окремій стрічці) виконуються перед ротацією журналів. Ця директива може тільки появлятись в середені визначення журналу. Також дивіться \fBpostrotate\fR.

.TP
.B rotate count
Журнал циклічно зсувається <count> разів перед видаленням чи відправкою почтою на адрес вказаний у директиві \fBmail\fR. Якщо count рівне 0, стара версія журналу видаляється і ротація не відбувається.

.TP
.B size size
Журнал циклічно зсувається коли він стає більшим за size в байтах. Якщо вкінці є M, то розмір рахується в мегабайтах. Якщо стоїть k, то розмір рахується в кілобайтах. Так допустимими є значення 100, 100k, і 100M.

.TP
.B sharedscripts
Звично \fBprescript\fR і \fBpostscript\fR запускаються для кожного журналу, який циклічно зсувається, що означає запуск одного і тогож скрипта знову для кожного журналу що відповідає умові (наприклад /var/log/news/*.log). Якщо вказано опцію \fBsharedscript\fR скрипт запускається тільки раз, байдуже скільки журналів задовольняють умові. Однак якщо ні один журнал не потребує ротації скрипт не запускається взагалі. Цю опцію змінює \fBnosharedscripts\fR.

.TP
.B start count
Вказує номер з якого починати рахувати ротації. Наприклад якщо вкажете 0, старі журнали будуть створюватись з суфіксом .0 який додасться до назви первинного журналу. Якщо вкажете 9 то архів журналів будуть з суфіксами, що почнуться з .9, а 0\-8 пропустяться. Журнал все одно буде зсуватись визначену опцією \fBcount\fR кількість разів.

.TP
.B tabooext [+] list
Змінює поточний список заборонених розширень ( дивіться директиву \fBinclude\fR де є інформація про заборонені розширення). Якщо стоїть + перед списком розширень то поточний список поповнюється, інакше заміняється. При старті список заборонених розширень містить: .rpmorig, .rpmsave, ,v, .swp, .rpmnew, та ~.

.TP
.B weekly
Журнал циклічно зсувається, якщо поточний день тижня менший ніж день тижня коли відбувалась остання ротація, або коли пройшло більш ніж тиждень з часу останньої ротації. Тобто журнали циклічно зсуваються в перший день тижня, але працює краще коли \fBlogrotate\fR запускається не кожної ночі.

.SH "ФАЙЛИ"
.PP

\fB\fI/var/lib/logrotate.status\fB\fR   Файл статусу по\-замовчуванню.
.br

.br

\fB\fI/etc/logrotate.conf\fB\fR         Файл з налаштуваннями.
.br

.br

\fB\fI/etc/logrotate.d\fB\fR            Директорія з файлами налаштувань.

.SH "ПОДІБНІ ТЕМИ"
.PP

\fBSyslog\-ng \- записувач подій в UNIX\fR, \fBgzip(1)\fR.

.SH "АВТОРИ"
.PP

Ерік Троян (Erik Troan) <ewt@redhat.com>
.br

.br

Престон Бравн (Preston Brown) <pbrown@redhat.com>

